## ESP32 墨水屏看板（7.3寸）

### 硬件与引脚
#### 主控
本项目使用乐鑫 ESP32-S3-N8R8 模块，安装在自制的 PCB 板上使用。  
当然，你也可以不用本项目提供的 PCB 板，使用任何成品 ESP32-S3 开发板进行制作。  
如使用其它开发板或模块，请注意选择带 PSRAM 的型号（需至少 384K PSRAM）。  
#### 屏幕
本项目使用 7.3 寸四色墨水屏，型号为 EL073TS3。使用 GxEPD2 库驱动（GxEPD2_730c_GDEY073D46）。  
其它尺寸、型号请自行参照 GxEPD2 库中的硬件支持列表修改构造函数。
#### 墨水屏转接板
本项目使用 B 站"记得带马扎"制作的七色 EPD 墨水屏转接板。  
但市面上的大部分 24pin SPI 转接板均可兼容。

#### 引脚定义
墨水屏使用 SPI 通信，本项目默认引脚为：
- `PIN_EPD_BUSY = 14`
- `PIN_EPD_RST  = 13`
- `PIN_EPD_DC   = 12`
- `PIN_EPD_CS   = 11`
- `PIN_EPD_SCLK = 10`
- `PIN_EPD_DIN  = 9`

### 主板焊接（可选）
原理图、BOM清单、制板文件均位于```esp32/pcb```文件夹中。  
原理图中的 H1 - H6 为测试焊盘引出，无需焊接真实器件：
- H1: UART 串口
- H2: USB
- H3: BOOT引脚，烧录固件时需将改引脚短接到 GND 后上电
- H4: 焊接至 EPD 墨水屏转接板
- H5: 3.7V 电池焊盘
- H6: 5V 输入测试焊盘

建议使用 UART 串口烧录固件。R2、R3、C5、C6 供 USB 使用，如无需要，可留空不焊。

SW1 按键为 REST 键，按下后会强制重启，并从服务器拉取、显示图片一次。RESET 键可将设备从长休眠状态中唤醒。  
SW2 - SW4 是引出的保留GPIO，用于未来未实现的功能。如无需要，可留空不焊。

### 字体与资源
-  需提前准备 up 主头像```avatar.jpg```放到```esp32/resource/resources/```文件夹下，建议尺寸 300 x 300（也可在```config.py```中指定其它位置）。
- （可选）如需使用自定义中文字体，可放入 ```esp32/resource/fonts/``` 中，并在```esp_render.py```的```load_font()```函数中声明。


### 编译与烧录

建议使用 Arduino IDE。

1. 安装 ESP32 Arduino Core。
2. 选择开发板：ESP32-S3（必须开启 PSRAM）。
3. 安装依赖库：
   - `GxEPD2`
4. 打开并编译/烧录 `ink-display-7C.ino`。

### 首次配置

设备启动时，会尝试从 NVS 读取已保存的 Wi-Fi 配置；若未配置或 Wi-Fi 连接失败，会自动进入 AP 配置模式：

- 设备会开启 AP 热点：`BiliDashboard-xxxx`
- 默认密码：`12345678`
- 连接 AP ，用浏览器访问配置页面：`http://192.168.4.1/`
- 配置 Wi-Fi、服务器地址、定时更新时间并保存，设备会自动重启并进入正常工作流程。

### 刷新与休眠

- 设备每天会在配置的更新时间，从服务器拉取一次当日生成的图片，并刷新墨水屏。
- 成功刷新后，会进入 Deep Sleep，直到下一次被唤醒。
- 若下载超时（默认 60s），也会进入长休眠，避免异常耗电。
- 在任意时候，按下 RESET 键，会强制重启并马上拉取、刷新一次图片。
- 长休眠待机电流约 1 - 2mA，使用 2 节 18650 电池约可实现半年续航。